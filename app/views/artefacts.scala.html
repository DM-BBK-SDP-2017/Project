@(artefacts:List[Artefact],loginForm:play.api.data.Form[User],user:String)(implicit messages: Messages)



@main( play.Play.application().configuration().getString("application.name") , loginForm ,user) {

	<link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/magicsuggest-min.css")">
	<script src='@routes.Assets.at("javascripts/magicsuggest/magicsuggest-min.js")' type="text/javascript"></script>
	<script src='@routes.Assets.at("javascripts/feedhelper.js")' type="text/javascript"></script>
	<script src="https://cloud.tinymce.com/stable/tinymce.min.js"></script>





	<div class="well" id="artefacts"></div>

	<div  class="modal fade" id="artefact" role="dialog" style="min-width: 95%; min-height: 95%;">
		<div class="modal-dialog" id="artefact-modal-dialogue" >

				<!-- Modal content-->
			<div class="modal-content" id="artefact-modal-content">
				<div class="modal-header">
					<h4 class="modal-title">Title</h4>
				</div>
				<div class="modal-body">

					<div class="form-group">
						<textarea id="info" name="info" draggable="false"></textarea>


							<!--div class="form-control" id="info" name="info" rows="5"></div-->

						@*<div style="overflow:auto;resize:none;min-width: 80%" draggable="false"*@


						<br>
						<div id="tags_container"><label class="tagslabel">tags</label>
						<div style="resize:none;min-width: 80%" draggable="false"
						class="form-control" id="tags" name="tags">
						</div>
						<br>
						<div id="submit_close_buttons">
							<button id = "" name="submission_button" class="btn btn-primary" data-dismiss="modal" type="button">Submit</button>
							<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
						</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>


			tinymce.init({
				selector:'#info',
				placeholder: 'Click here and begin typing',
				inline: false,
				entity_encoding : "named",
				valid_elements : 'a[href|target=_blank],strong/b,div[align],br',
				height: "80"@*,
				theme: "inline"*@
			});



			var tags = [];
			var ms;

			$(document).ready(function() {
				$("#tags").hide();

				msex = function() {

					ms = $('#tags').magicSuggest({
						allowFreeEntries: true,
						placeholder: 'Begin typing to search for existing tags or to add your own',
						vregex: /^[a-zA-Z0-9_-]{1,20}$/,
						maxSelection: 3,
						data: tags
					});

					console.log('data tags size ' + ms.getData().length);
				};


				@*IF TIME - CHECK FOR SESSION BEFORE CALLING THIS https://www.playframework.com/documentation/2.5.x/ScalaSessionFlash*@

				getArtefactTags(msex);


			});

			$(".tagslabel").click(function(){
				$("#tags").toggle(500);
			});




			$('#postButton').hover(
					function() {
						add();
					}
			);
			$('#postButton').click(
					function() {
						$('#artefact').modal('hide');
					}
			);




			@if( user == null ) {
			$('#postButton').prop('disabled', true);
			} else {
			$('#postButton').prop('disabled', false);
			}

			loadData();


			function postTags(func) {
				for (var i = 0; i < ms.getValue().length; i++) {

					if (tags.indexOf(ms.getValue()[i]) == -1) {

						//postArtefactTags(ms.getValue()[i]);
						tags.push(ms.getValue()[i]);

					}
				}

				func();

			}


			function postNewArtefact() {


				var tags_ids_String = ms.getValue().join();
				var user = $('#user').val();
				var info = htmlEncode(tinyMCE.get('info').getContent());
				//$( infofromtinyMCE ).serialize();
				//var json = '{ "id": 0, "content":"' + info + '", "tags_ids_string": "' + tags_ids_String + '", "creator": 0, "created": "1971-01-01T00:00:00.000" }'

				var json = '{ "id": 0, "content":"' + info.replace(/[\r?\n]/g, " ") + '", "tags_ids_string": "' + tags_ids_String + '", "creator": 0, "created": "1971-01-01T00:00:00.000" }'

				//console.log(json)
				$('#user').val('')
				tinyMCE.get('info').setContent('');
				$.ajax({
					type : "POST",
					contentType : "application/json; charset=utf-8",
					data : json,
					url : "/api/artefacts",
					success : function(data) {
						console.log(data);

						ms.clear();
						loadData();
					},
					error : function(response) {
						alert("error " + response.statusText + ":"+ response.status+" - " +response.responseText)
					}
				});


			}

			var error = null;



	</script>

}
