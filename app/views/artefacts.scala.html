@import models.Artefact
@import models.Users.User
@(artefacts:List[Artefact],loginForm:play.api.data.Form[User],user:String)(implicit flash: Flash)



@main( play.Play.application().configuration().getString("application.name") , loginForm ,user) {

	<script src='@routes.Assets.at("javascripts/magicsuggest/magicsuggest-min.js")' type="text/javascript"></script>
	<script src='@routes.Assets.at("javascripts/artefactsJsHelper.js")' type="text/javascript"></script>
	<script src='@routes.Assets.at("javascripts/tinymce/tinymce.min.js")' type="text/javascript"></script>

	<!--script src="https://cloud.tinymce.com/stable/tinymce.min.js"></script-->

	<link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/magicsuggest-min.css")">



	<div class="container">

		<div class="row">
				<!--div class="jumbotplay.api.i18n.Messagesron"-->
			<div class="col-md-6">
				<h2>@play.Play.application().configuration().getString("application.name")</h2>
			</div>

			@*SEARCH BAR*@

			<div class="col-md-4">
				<div style="min-height: 15px"> </div>
				<form id="artefact_search" class="search-form">
					<div class="form-group has-feedback">
						<label for="search" class="sr-only">Search</label>
						<input onsubmit="search()" type="text" class="form-control" name="search" id="search" placeholder="search....">
						<span class="glyphicon glyphicon-search form-control-feedback"></span>
					</div>
				</form>
			</div>

			@*END SEARCH BAR*@



			<div class="col-md-2 align-self-center">
				<div style="min-height: 10px"> </div>

				<button type="button" class="btn btn-primary btn-lg" id="postButton" onClick="add()">New Artefact</button>
			</div>
		</div>
	</div>


	<div class="well" id="artefacts"></div>


	<div  class="modal fade" id="artefact" role="dialog" style="min-width: 95%; min-height: 95%;">
		<div class="modal-dialog" id="artefact-modal-dialogue" >

				<!-- Modal content-->
			<div class="modal-content" id="artefact-modal-content">
				<div class="modal-header">
					<h4 class="modal-title">Title</h4>
				</div>
				<div class="modal-body">

						<!--div class="form-group"-->
					<textarea id="info" name="info" draggable="false"></textarea>


						<!--div class="form-control" id="info" name="info" rows="5"></div-->

					@*<div style="overflow:auto;resize:none;min-width: 80%" draggable="false"*@


					<br>
						<!--div id="tags_container"-->

					<label class="tagslabel">tags</label>
					<input name="something" id="tags" />
					<br>
					<label class="categorylabel">Category</label>
					<input name="something" id="category" />
					<div id="submit_close_buttons">
						<button id = "" name="submission_button" class="btn btn-primary" data-dismiss="modal" type="button">Submit</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>


						<!--/div-->
						<!--/div-->
				</div> <!--end of modal-->
			</div>
		</div>
	</div>

	<script>




			$('#artefact_search').submit(function(ev) {
				ev.preventDefault(); // to stop the form from submitting
				/* Validations go here */
				//this.submit(); // If all the validations succeeded
				var values = document.getElementById('search').value;
				//console.log(values);
				search(values);
				$()
			});

			tinymce.init({
				selector:'#info',
				placeholder: 'Click here and begin typing',

				valid_elements : 'a[href|target=_blank],strong/b,div[align],br'@*,
				entity_encoding : "named",
				inline: false,
				height: "80",
				theme: "inline"*@
			});



			var tags = [];
			var ms;

			function msex() {
				ms = $('#tags').magicSuggest({
					allowFreeEntries: true,
					placeholder: 'Begin typing to search for existing tags or to add your own',
					vregex: /^[a-zA-Z0-9_-]{1,20}$/,
					maxSelection: 3,
					data: tags
				});
			};

			var categories;
			var categoriesMS;





			$(document).ready(function() {
				//$("#tags").hide();



				categories = $.getJSON("api/categories").success(function categoriesMagicSuggest(cats) {
					categoriesMS = $('#category').magicSuggest({
						allowFreeEntries: false,
						placeholder: 'Begin typing to search for categories',
						maxSelection: 1,
						data: cats



					})});


				$("[id='submitEditArtefactButton']").unbind('click').on(
						'click',
						function (e) {
							e.preventDefault();
							//console.log("HERE");


							updateArtefact(arg);


						});






				@*IF TIME - CHECK FOR SESSION BEFORE CALLING THIS https://www.playframework.com/documentation/2.5.x/ScalaSessionFlash*@

				getArtefactTags(msex);


			});

			//$(".tagslabel").click(function(){
			//	$("#tags").toggle(500);
			//});




			$('#postButton').click(
					function() {
						add();
					}
			);
			//$('#postButton').click(
			//		function() {
			//			$('#artefact').modal('hide');
			//		}
			//);




			@if( user == null ) {
			$('#postButton').prop('disabled', true);
			} else {
			$('#postButton').prop('disabled', false);
			}

			loadData();
			var error = null;

	</script>

}(flash)
